# CC03 v65.0 - Alertmanagerè¨­å®š
# ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

global:
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alerts@itdo-erp.com'
  smtp_auth_username: 'alerts@itdo-erp.com'
  smtp_auth_password: 'AlertPassword2025!'
  smtp_require_tls: true

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¨­å®š
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
  receiver: 'default'
  routes:
    # é‡è¦åº¦: Critical - å³åº§é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 10s
      repeat_interval: 5m
      
    # é‡è¦åº¦: Warning - é€šå¸¸é€šçŸ¥
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 5m
      repeat_interval: 30m
      
    # ã‚·ã‚¹ãƒ†ãƒ é–¢é€£ã‚¢ãƒ©ãƒ¼ãƒˆ
    - match:
        category: system
      receiver: 'system-alerts'
      
    # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ã‚¢ãƒ©ãƒ¼ãƒˆ
    - match:
        category: database
      receiver: 'database-alerts'
      
    # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£ã‚¢ãƒ©ãƒ¼ãƒˆ
    - match:
        category: application
      receiver: 'application-alerts'

# å—ä¿¡è€…è¨­å®š
receivers:
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå—ä¿¡è€…
  - name: 'default'
    email_configs:
      - to: 'admin@itdo-erp.com'
        subject: '[ITDO ERP v65] {{ .GroupLabels.alertname }}'
        body: |
          {{ range .Alerts }}
          ã‚¢ãƒ©ãƒ¼ãƒˆ: {{ .Annotations.summary }}
          è©³ç´°: {{ .Annotations.description }}
          ç™ºç”Ÿæ™‚åˆ»: {{ .StartsAt }}
          {{ end }}

  # é‡è¦ã‚¢ãƒ©ãƒ¼ãƒˆ - è¤‡æ•°ãƒãƒ£ãƒ³ãƒãƒ«é€šçŸ¥
  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@itdo-erp.com'
        subject: 'ğŸš¨ [CRITICAL] ITDO ERP v65 - {{ .GroupLabels.alertname }}'
        body: |
          ğŸš¨ CRITICAL ALERT ğŸš¨
          
          {{ range .Alerts }}
          ã‚¢ãƒ©ãƒ¼ãƒˆå: {{ .Annotations.summary }}
          è©³ç´°: {{ .Annotations.description }}
          ç™ºç”Ÿæ™‚åˆ»: {{ .StartsAt }}
          å½±éŸ¿åº¦: {{ .Labels.severity }}
          ã‚µãƒ¼ãƒ“ã‚¹: {{ .Labels.service }}
          ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: {{ .Labels.instance }}
          {{ end }}
          
          å³åº§ã«å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚
          
          ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰: http://localhost:3001
          Prometheus: http://localhost:9090
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#alerts-critical'
        title: 'ğŸš¨ Critical Alert - ITDO ERP v65'
        text: |
          {{ range .Alerts }}
          *{{ .Annotations.summary }}*
          {{ .Annotations.description }}
          {{ end }}

  # è­¦å‘Šã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'warning-alerts'
    email_configs:
      - to: 'monitoring@itdo-erp.com'
        subject: 'âš ï¸ [WARNING] ITDO ERP v65 - {{ .GroupLabels.alertname }}'
        body: |
          âš ï¸ WARNING ALERT âš ï¸
          
          {{ range .Alerts }}
          ã‚¢ãƒ©ãƒ¼ãƒˆå: {{ .Annotations.summary }}
          è©³ç´°: {{ .Annotations.description }}
          ç™ºç”Ÿæ™‚åˆ»: {{ .StartsAt }}
          ã‚µãƒ¼ãƒ“ã‚¹: {{ .Labels.service }}
          {{ end }}

  # ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'system-alerts'
    email_configs:
      - to: 'sysadmin@itdo-erp.com'
        subject: 'ğŸ–¥ï¸ [SYSTEM] ITDO ERP v65 - {{ .GroupLabels.alertname }}'
        body: |
          ğŸ–¥ï¸ SYSTEM ALERT ğŸ–¥ï¸
          
          {{ range .Alerts }}
          ã‚·ã‚¹ãƒ†ãƒ : {{ .Labels.instance }}
          ã‚¢ãƒ©ãƒ¼ãƒˆ: {{ .Annotations.summary }}
          è©³ç´°: {{ .Annotations.description }}
          ç™ºç”Ÿæ™‚åˆ»: {{ .StartsAt }}
          CPUä½¿ç”¨ç‡: {{ .Labels.cpu_usage }}%
          ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡: {{ .Labels.memory_usage }}%
          {{ end }}

  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'database-alerts'
    email_configs:
      - to: 'dba@itdo-erp.com'
        subject: 'ğŸ—„ï¸ [DATABASE] ITDO ERP v65 - {{ .GroupLabels.alertname }}'
        body: |
          ğŸ—„ï¸ DATABASE ALERT ğŸ—„ï¸
          
          {{ range .Alerts }}
          ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: {{ .Labels.database }}
          ã‚¢ãƒ©ãƒ¼ãƒˆ: {{ .Annotations.summary }}
          è©³ç´°: {{ .Annotations.description }}
          ç™ºç”Ÿæ™‚åˆ»: {{ .StartsAt }}
          æ¥ç¶šæ•°: {{ .Labels.connections }}
          {{ end }}

  # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¢ãƒ©ãƒ¼ãƒˆ
  - name: 'application-alerts'
    email_configs:
      - to: 'dev@itdo-erp.com'
        subject: 'ğŸš€ [APPLICATION] ITDO ERP v65 - {{ .GroupLabels.alertname }}'
        body: |
          ğŸš€ APPLICATION ALERT ğŸš€
          
          {{ range .Alerts }}
          ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³: {{ .Labels.application }}
          ã‚¢ãƒ©ãƒ¼ãƒˆ: {{ .Annotations.summary }}
          è©³ç´°: {{ .Annotations.description }}
          ç™ºç”Ÿæ™‚åˆ»: {{ .StartsAt }}
          ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: {{ .Labels.response_time }}ms
          ã‚¨ãƒ©ãƒ¼ç‡: {{ .Labels.error_rate }}%
          {{ end }}

# ã‚¢ãƒ©ãƒ¼ãƒˆæŠ‘åˆ¶è¨­å®š
inhibit_rules:
  # ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢æ™‚ã¯ä»–ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’æŠ‘åˆ¶
  - source_match:
      alertname: ServiceDown
    target_match:
      service: '.*'
    equal: ['service', 'instance']
    
  # Criticalç™ºç”Ÿæ™‚ã¯Warningã‚’æŠ‘åˆ¶
  - source_match:
      severity: critical
    target_match:
      severity: warning
    equal: ['alertname', 'instance']
    
  # ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡Criticalæ™‚ã¯é–¢é€£Warningã‚’æŠ‘åˆ¶
  - source_match:
      alertname: DiskSpaceCritical
    target_match:
      alertname: DiskSpaceWarning
    equal: ['instance', 'device']

# ã‚¢ãƒ©ãƒ¼ãƒˆæ™‚é–“è¨­å®š
time_intervals:
  - name: working-hours
    time_intervals:
      - times:
          - start_time: '09:00'
            end_time: '18:00'
        weekdays: ['monday:friday']
        
  - name: emergency-hours
    time_intervals:
      - times:
          - start_time: '00:00'
            end_time: '23:59'
        weekdays: ['monday:sunday']