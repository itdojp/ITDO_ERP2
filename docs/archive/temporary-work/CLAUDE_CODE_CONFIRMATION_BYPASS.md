# Claude Code コマンド実行確認の抑制方法

## 問題分析
Claude Codeが以下の場合にコマンド実行確認で停止することがある：
1. 破壊的な操作（`rm -rf`、データベース削除など）
2. `sudo`や権限昇格が必要な操作
3. 大量のファイル変更
4. 本番環境への影響がある操作
5. セキュリティに関わる操作

## 🎯 確認プロンプトを抑制する方法

### 方法1: 安全なコマンドパターンの使用

```bash
# ❌ 確認が発生しやすいコマンド
rm -rf /some/directory
sudo apt-get install package
git push --force

# ✅ 確認を回避するコマンド
# 削除前にバックアップ
cp -r /some/directory /some/directory.backup && rm -rf /some/directory

# 権限昇格を避ける
# すでに適切な権限で実行されている前提で記述

# 段階的な実行
git add . && git commit -m "message" && git push
```

### 方法2: エージェントへの事前許可指示

```
【事前許可宣言】
以下の操作について、安全性を確認済みのため、確認なしで実行してください：

✅ 開発環境でのファイル操作（作成・編集・削除）
✅ gitコマンド全般（push/pull/merge）
✅ npmやuvなどのパッケージマネージャー操作
✅ テストの実行
✅ ビルドコマンド
✅ データベースマイグレーション（開発環境）
✅ Docker/Podmanコマンド（開発環境）

これらは全て開発環境での作業であり、本番への影響はありません。
確認プロンプトなしで続行してください。
```

### 方法3: バッチ実行指示

```
【バッチ実行モード】
以下のコマンドセットを一括実行してください。
各コマンドは安全性確認済みです：

```bash
# フロントエンドビルド
cd frontend && npm run build

# バックエンドテスト
cd ../backend && uv run pytest

# データベースマイグレーション
uv run alembic upgrade head

# サービス再起動
make restart-dev
```

全て開発環境での実行のため、確認不要で進めてください。
```

### 方法4: 明示的な自動化許可

```
【自動化実行許可】
このセッションでは、以下の条件で自動実行を許可します：

1. 対象環境: 開発環境のみ
2. 対象操作: 
   - ソースコード変更
   - テスト実行
   - ビルド・デプロイ（開発環境）
   - パッケージインストール
3. 除外操作:
   - 本番環境への操作
   - システム設定の変更
   - 認証情報の変更

上記範囲内では確認プロンプトをスキップし、
効率的に作業を進めてください。
```

### 方法5: コマンドの前処理

```bash
# 確認を避けるための前処理コマンド
# 例: ディレクトリ削除の場合

# ❌ 直接削除（確認が発生）
rm -rf ./old-build

# ✅ 安全な削除手順
if [ -d "./old-build" ]; then
  mv ./old-build ./old-build.$(date +%s).bak
  echo "Backed up old-build directory"
fi
mkdir -p ./old-build
```

## 🚀 エージェント向け確認回避指示テンプレート

### CC01/CC02/CC03 共通指示

```
【確認プロンプト回避設定】

本セッションでは、開発効率化のため、以下の設定で動作してください：

1. **自動実行許可リスト**
   - git操作全般（add, commit, push, pull, merge）
   - npm/uv/pip等のパッケージ管理
   - ファイル作成・編集・削除（srcディレクトリ内）
   - テストコマンド全般
   - ビルド・コンパイルコマンド
   - 開発サーバー起動・停止

2. **条件付き自動実行**
   - DBマイグレーション → 開発DBのみ自動実行
   - Docker操作 → 開発環境のみ自動実行
   - API呼び出し → localhostのみ自動実行

3. **確認必須項目**（これ以外は確認不要）
   - 本番環境への操作
   - システムファイルの変更
   - 認証情報・秘密鍵の操作
   - 課金が発生する外部API

4. **効率化のための動作**
   - 複数コマンドはバッチで実行
   - エラー時は自動リトライ（3回まで）
   - 成功時は次のタスクへ自動移行

この設定により、不要な確認で作業が中断されることを防ぎます。
開発環境での作業は全て自動実行してください。
```

### 具体的な使用例

```bash
# CC01の例（確認なしで実行）
cd frontend
npm install                    # 自動実行
npm run test                  # 自動実行
npm run build                 # 自動実行
git add .                     # 自動実行
git commit -m "feat: add"     # 自動実行
git push                      # 自動実行

# CC02の例（確認なしで実行）
cd backend
uv add fastapi               # 自動実行
uv run pytest                # 自動実行
uv run alembic upgrade head  # 自動実行（開発DB）
git add . && git commit -m "fix" && git push  # 一括自動実行

# CC03の例（確認なしで実行）
cd infra
terraform plan               # 自動実行
terraform apply -auto-approve  # 開発環境のみ自動実行
docker-compose up -d         # 自動実行
make deploy-dev             # 自動実行
```

## 📝 まとめ

1. **事前許可宣言**で範囲を明確化
2. **安全なコマンドパターン**を使用
3. **バッチ実行**で確認回数を削減
4. **開発環境限定**を明記
5. **自動実行許可リスト**を提供

これにより、Claude Codeの確認プロンプトによる作業中断を最小化できます。