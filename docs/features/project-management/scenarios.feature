# language: ja

フィーチャー: プロジェクト管理システム
  ITDOのプロジェクトマネージャーとして
  プロジェクトを効率的に管理したい
  なぜならプロジェクトの成功率を向上させ、リソースを最適化したいから

  背景:
    前提 認証済みのプロジェクトマネージャーとしてログインしている
    かつ プロジェクト管理の権限を持っている

  シナリオ: 新規プロジェクトの作成
    もし "新規プロジェクト"ボタンをクリックする
    かつ 以下のプロジェクト情報を入力する:
      | 項目         | 値                           |
      | プロジェクト名 | 新ERP導入プロジェクト          |
      | コード       | ERP-2025-001                 |
      | 説明         | 全社ERPシステムの刷新          |
      | 開始日       | 2025-08-01                   |
      | 終了日       | 2026-03-31                   |
      | 予算         | 50000000                     |
      | ステータス    | 計画中                       |
    かつ "作成"ボタンをクリックする
    ならば プロジェクトが正常に作成される
    かつ プロジェクト詳細画面に遷移する
    かつ 作成したプロジェクト情報が表示される

  シナリオ: WBS（作業分解構造）の作成
    前提 "ERP-2025-001"プロジェクトが存在する
    もし プロジェクト詳細画面で"WBS"タブを選択する
    かつ "タスク追加"ボタンをクリックする
    かつ 以下のタスク情報を入力する:
      | 項目         | 値                    |
      | タスク名     | 要件定義              |
      | 説明         | システム要件の明確化    |
      | 開始日       | 2025-08-01            |
      | 終了日       | 2025-09-30            |
      | 見積工数     | 320                   |
    かつ "保存"ボタンをクリックする
    ならば タスクがWBSに追加される
    かつ タスクがガントチャートに表示される

  シナリオ: サブタスクの追加（階層構造）
    前提 "要件定義"タスクが存在する
    もし "要件定義"タスクを選択する
    かつ "サブタスク追加"をクリックする
    かつ 以下のサブタスク情報を入力する:
      | 項目         | 値                    |
      | タスク名     | 業務要件定義          |
      | 開始日       | 2025-08-01            |
      | 終了日       | 2025-08-31            |
      | 見積工数     | 160                   |
    かつ "保存"ボタンをクリックする
    ならば サブタスクが"要件定義"の下に追加される
    かつ 親タスクの期間が自動調整される
    かつ WBSが階層構造で表示される

  シナリオ: タスクの依存関係設定
    前提 "要件定義"タスクと"設計"タスクが存在する
    もし "設計"タスクを選択する
    かつ "依存関係"セクションを開く
    かつ "前提タスク"として"要件定義"を選択する
    かつ 依存タイプとして"終了-開始"を選択する
    かつ "保存"ボタンをクリックする
    ならば 依存関係が設定される
    かつ ガントチャートに依存線が表示される
    かつ "設計"の開始日が"要件定義"の終了日以降に自動調整される

  シナリオ: マイルストーンの設定
    前提 "ERP-2025-001"プロジェクトが存在する
    もし プロジェクト詳細画面で"マイルストーン"タブを選択する
    かつ "マイルストーン追加"ボタンをクリックする
    かつ 以下のマイルストーン情報を入力する:
      | 項目             | 値                    |
      | マイルストーン名  | 要件定義完了          |
      | 予定日           | 2025-09-30            |
      | 成果物           | 要件定義書            |
      | 承認者           | 田中太郎              |
    かつ "保存"ボタンをクリックする
    ならば マイルストーンが追加される
    かつ ガントチャートにダイヤモンド記号で表示される
    かつ 関連タスクとの紐付けが可能になる

  シナリオ: リソースの割り当て
    前提 "業務要件定義"タスクが存在する
    かつ 以下のリソースが登録されている:
      | 名前     | スキル              | 稼働率上限 |
      | 山田花子 | ビジネスアナリスト   | 100%      |
      | 佐藤次郎 | システムアナリスト   | 80%       |
    もし "業務要件定義"タスクを選択する
    かつ "リソース割当"セクションを開く
    かつ "山田花子"を50%で割り当てる
    かつ "佐藤次郎"を30%で割り当てる
    かつ "保存"ボタンをクリックする
    ならば リソースがタスクに割り当てられる
    かつ リソースの稼働状況が更新される
    かつ オーバーアロケーションがチェックされる

  シナリオ: ガントチャートでのスケジュール調整
    前提 ガントチャート画面を表示している
    かつ "設計"タスクが表示されている
    もし "設計"タスクのバーをドラッグする
    かつ 開始日を5日後ろにずらす
    ならば タスクの開始日と終了日が更新される
    かつ 依存する後続タスクも自動的に調整される
    かつ クリティカルパスが再計算される
    かつ プロジェクト全体の終了日が更新される

  シナリオ: 進捗の更新と追跡
    前提 "業務要件定義"タスクが進行中である
    もし タスク詳細画面を開く
    かつ 完了率を"30%"に更新する
    かつ 実績工数として"48時間"を入力する
    かつ "更新"ボタンをクリックする
    ならば タスクの進捗が更新される
    かつ ガントチャートの進捗バーが更新される
    かつ 親タスクの進捗が自動計算される
    かつ プロジェクト全体の進捗が更新される

  シナリオ: 遅延タスクの検出と警告
    前提 現在日が"2025-09-01"である
    かつ "業務要件定義"の終了予定日が"2025-08-31"である
    かつ タスクの完了率が"70%"である
    もし システムが日次チェックを実行する
    ならば タスクが遅延として検出される
    かつ プロジェクトマネージャーに通知が送信される
    かつ ダッシュボードに遅延警告が表示される
    かつ 影響を受ける後続タスクがハイライトされる

  シナリオ: リソース稼働率の分析
    前提 複数のプロジェクトが存在する
    かつ "山田花子"が複数のタスクに割り当てられている
    もし "リソース管理"画面を開く
    かつ "山田花子"を選択する
    かつ 期間として"2025年8月"を指定する
    ならば 月間の稼働率グラフが表示される
    かつ 日別の割当状況が表示される
    かつ オーバーアロケーションの日が赤色で表示される
    かつ 稼働率の最適化提案が表示される

  シナリオ: プロジェクトレポートの生成
    前提 "ERP-2025-001"プロジェクトが進行中である
    もし "レポート"メニューを選択する
    かつ "進捗レポート"を選択する
    かつ レポート期間として"2025年8月"を指定する
    かつ "生成"ボタンをクリックする
    ならば 以下の情報を含むレポートが生成される:
      | 項目               | 内容                        |
      | プロジェクト進捗率  | 全体の完了率とトレンド       |
      | マイルストーン状況  | 達成/未達成のマイルストーン  |
      | タスク統計         | 完了/進行中/未着手の内訳     |
      | リソース稼働状況   | メンバー別の稼働率          |
      | 課題とリスク       | 遅延タスクと対策            |
      | 予算消化状況       | 予算対実績の比較            |
    かつ PDFまたはExcelでダウンロード可能である

  シナリオ: 複数プロジェクトのポートフォリオ管理
    前提 管理者権限を持っている
    かつ 10個のアクティブなプロジェクトが存在する
    もし "ポートフォリオ"ダッシュボードを開く
    ならば 全プロジェクトの概要が表示される
    かつ 以下の情報が確認できる:
      | 項目               | 表示内容                    |
      | プロジェクト一覧   | ステータス別の分類          |
      | 全体進捗          | 平均進捗率とトレンド         |
      | リソース配分      | プロジェクト別の人員配置     |
      | 予算状況          | 全体予算と消化率            |
      | リスクマップ      | 高リスクプロジェクトの識別   |
    かつ ドリルダウンして詳細を確認できる

  シナリオ: サブプロジェクトの作成（階層構造）
    前提 "ERP-2025-001"プロジェクトが存在する
    もし プロジェクト詳細画面で"サブプロジェクト"セクションを開く
    かつ "サブプロジェクト追加"ボタンをクリックする
    かつ 以下のサブプロジェクト情報を入力する:
      | 項目         | 値                           |
      | プロジェクト名 | 要件定義フェーズ              |
      | コード       | ERP-2025-001-REQ             |
      | 説明         | 要件定義工程の詳細管理        |
      | 開始日       | 2025-08-01                   |
      | 終了日       | 2025-09-30                   |
      | 予算         | 10000000                     |
    かつ "作成"ボタンをクリックする
    ならば サブプロジェクトが作成される
    かつ 親プロジェクトの下に階層表示される
    かつ サブプロジェクトの予算が親プロジェクトから割り当てられる
    かつ 親プロジェクトの進捗にサブプロジェクトが含まれる

  シナリオ: プロジェクトメンバーの管理
    前提 "ERP-2025-001"プロジェクトが存在する
    もし プロジェクト詳細画面で"メンバー"タブを選択する
    かつ "メンバー追加"ボタンをクリックする
    かつ 以下のメンバー情報を設定する:
      | ユーザー名 | 役割              | 参画率 | 開始日      | 終了日      |
      | 田中太郎   | プロジェクトリーダー | 100%  | 2025-08-01  | 2026-03-31  |
      | 山田花子   | アーキテクト       | 80%   | 2025-08-01  | 2025-12-31  |
      | 佐藤次郎   | 開発リーダー       | 100%  | 2025-10-01  | 2026-03-31  |
    かつ "保存"ボタンをクリックする
    ならば メンバーがプロジェクトに追加される
    かつ 各メンバーの役割と参画期間が表示される
    かつ プロジェクトリーダーには特別な権限が付与される
    かつ メンバーの稼働予定がリソース管理に反映される

  シナリオ: 繰り返しプロジェクトの設定（定期保守）
    もし "新規プロジェクト"ボタンをクリックする
    かつ プロジェクトタイプとして"繰り返し"を選択する
    かつ 以下の繰り返しプロジェクト情報を入力する:
      | 項目         | 値                           |
      | プロジェクト名 | システム定期保守              |
      | コード       | MAINT-2025-MON               |
      | 説明         | 月次システム保守作業          |
      | 繰り返し周期  | 毎月                        |
      | 開始日       | 2025-08-01                   |
      | 期間         | 2日                          |
      | 予算（月額）  | 500000                       |
      | 繰り返し回数  | 12                          |
    かつ "作成"ボタンをクリックする
    ならば 繰り返しプロジェクトのマスターが作成される
    かつ 12ヶ月分の個別プロジェクトが自動生成される
    かつ 各月のプロジェクトが独立して管理可能である
    かつ 年間予算が自動計算される

  シナリオ: 予実管理（見積・実績の比較）
    前提 "ERP-2025-001"プロジェクトが進行中である
    かつ 見積金額50,000,000円が設定されている
    かつ 見積工数2,000時間が設定されている
    もし プロジェクト詳細画面で"予実管理"タブを選択する
    かつ 以下の実績情報が登録されている:
      | 項目       | 予定     | 実績     | 差異      |
      | 人件費     | 20,000,000 | 18,500,000 | -1,500,000 |
      | 外注費     | 15,000,000 | 16,200,000 | +1,200,000 |
      | 経費      | 5,000,000  | 4,800,000  | -200,000   |
      | 工数      | 800時間    | 850時間    | +50時間    |
    ならば 予実比較グラフが表示される
    かつ 予算消化率が計算される（39.5%）
    かつ 工数消化率が計算される（42.5%）
    かつ 現在のペースでの最終見込みが表示される
    かつ 予算超過リスクがある場合は警告が表示される

  シナリオ: プロジェクト収益性分析
    前提 "ERP-2025-001"プロジェクトが存在する
    かつ 契約金額60,000,000円が設定されている
    もし "収益性分析"画面を開く
    かつ プロジェクトを選択する
    ならば 以下の収益性指標が表示される:
      | 指標             | 値                          |
      | 契約金額         | 60,000,000円                |
      | 見積原価         | 50,000,000円                |
      | 見積利益         | 10,000,000円                |
      | 見積利益率       | 16.7%                       |
      | 実績原価（現在）  | 39,500,000円                |
      | 完成時原価見込み  | 52,000,000円                |
      | 予想利益         | 8,000,000円                 |
      | 予想利益率       | 13.3%                       |
    かつ 月次の収益推移グラフが表示される
    かつ リスク要因と改善提案が表示される