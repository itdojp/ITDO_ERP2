# Claude Code 使用ガイド

## 概要

このガイドでは、ITDO ERP System v2プロジェクトでClaude Codeを使用する際の正しい方法について説明します。

## プロジェクト設定ファイル

Claude Codeは以下の設定ファイルを参照して開発を行います：

### メイン設定ファイル
- **CLAUDE.md** - Claude Code用のメイン設定とプロジェクト概要

### 詳細設定ファイル（.claudeディレクトリ）
- **.claude/PROJECT_CONTEXT.md** - プロジェクトコンテキストとビジネスドメイン知識
- **.claude/DEVELOPMENT_WORKFLOW.md** - 詳細な開発ワークフローとプロセス
- **.claude/CODING_STANDARDS.md** - コーディング規約と品質要件
- **.claude/TECHNICAL_CONSTRAINTS.md** - 技術的制約と制限事項

## Claude Code起動時のプロンプト

### パターン1: 直接的な指示（簡潔版）
```
CLAUDE.mdファイルを読み込んで、そこに記載された開発ルールと制約に従って開発を進めてください。
```

### パターン2: 詳細な指示
```
まず最初にCLAUDE.mdファイルを読み込み、そこに記載されている「Required Reading Files」セクションの4つのファイルもすべて読み込んでください。その後、記載されている開発プロセスと制約事項に厳密に従って開発作業を行ってください。
```

### パターン3: 具体的なタスクと組み合わせ
```
CLAUDE.mdファイルとそこで参照されているすべての設定ファイルを読み込んでから、Issue #[番号] の [機能名] の実装を8段階の開発プロセスに従って行ってください。
```

### パターン4: 最も確実な方法（推奨）
```
以下の手順で開発を進めてください：

1. CLAUDE.mdファイルを読み込む
2. CLAUDE.mdの「Required Reading Files」に記載された以下の4つのファイルを読み込む：
   - .claude/PROJECT_CONTEXT.md
   - .claude/DEVELOPMENT_WORKFLOW.md
   - .claude/CODING_STANDARDS.md
   - .claude/TECHNICAL_CONSTRAINTS.md
3. これらのファイルに記載されたルール、制約、プロセスに従って Issue #[番号] の実装を行う

特に以下を厳守してください：
- TDD（テスト駆動開発）
- 8段階の開発プロセス
- 型安全性（any型禁止）
- ハイブリッド開発環境の使用
```

## 実際の使用例

### Issue実装時の完全なプロンプト例

Issue #123の「ユーザー管理機能」を実装する場合：

```
以下の手順で開発を進めてください：

1. CLAUDE.mdファイルを読み込む
2. CLAUDE.mdの「Required Reading Files」に記載された4つの設定ファイルをすべて読み込む
3. これらの設定に従って Issue #123 の「ユーザー管理機能」を実装する

必須事項：
- 8段階の開発プロセスに従う
- テストコードを先に実装（TDD）
- 型安全性を確保
- ハイブリッド開発環境を使用

実装対象：
- ユーザーCRUD操作のAPI
- フロントエンドのユーザー管理画面
- 認証・認可の統合
```

### 短縮版（慣れてきた場合）

```
CLAUDE.mdの設定に従って Issue #[番号] の [機能名] を実装してください。
```

## 開発プロセス

Claude Codeは以下の8段階プロセスに従って開発を行います：

1. **Issue確認フェーズ** - 要件の理解と関連Issue/PRの確認
2. **Draft PR作成フェーズ** - ブランチ作成とDraft PR作成
3. **仕様書作成フェーズ** - 詳細仕様書の作成
4. **テスト仕様作成フェーズ** - テストケースの定義
5. **テストコード実装フェーズ** - テストファーストでの実装
6. **実装フェーズ** - プロダクションコードの実装
7. **ドキュメント更新フェーズ** - 関連ドキュメントの更新
8. **レビュー準備フェーズ** - セルフレビューとPR準備

## 重要な制約事項

### 必須制約
- **TDD（テスト駆動開発）**: テストコードを先に実装
- **Issue起点開発**: すべての作業はGitHub Issueから開始
- **型安全性**: any型の使用禁止、strict型チェック必須
- **ハイブリッド環境**: データ層はコンテナ、開発層はローカル推奨
- **uvツール使用**: Python環境管理（pip/activate使用禁止）

### 品質基準
- API応答時間: 200ms以内
- テストカバレッジ: 80%以上
- 同時接続数: 1000ユーザー対応
- エラーハンドリング: すべての関数で必須実装

## 開発環境コマンド

### データ層起動（必須）
```bash
podman-compose -f infra/compose-data.yaml up -d
```

### ローカル開発（推奨）
```bash
# Backend
cd backend && uv run uvicorn app.main:app --reload

# Frontend（別ターミナル）
cd frontend && npm run dev
```

### テスト実行
```bash
# Backend
cd backend && uv run pytest

# Frontend
cd frontend && npm test
```

### 型チェック
```bash
# Backend
cd backend && uv run mypy --strict .

# Frontend
cd frontend && npm run typecheck
```

## トラブルシューティング

### Claude Codeが設定ファイルを読み込まない場合

1. **明示的にファイル名を指定**
   ```
   .claude/DEVELOPMENT_WORKFLOW.mdファイルの内容を確認してから実装してください。
   ```

2. **ファイル存在確認**
   ```bash
   ls -la CLAUDE.md .claude/
   ```

3. **手動でファイル内容をプロンプトに含める**
   設定ファイルの重要な部分を直接プロンプトに記載する

### 開発プロセスが守られない場合

1. **段階的な指示**
   各フェーズを個別に指示する

2. **制約事項の再確認**
   TDDや型安全性などの制約を明示的に指示

3. **品質チェック**
   実装後に品質基準を満たしているか確認

## ベストプラクティス

### 初回使用時
- **パターン4**（最も確実な方法）を使用
- 設定ファイルが正しく読み込まれているか確認
- 8段階プロセスが守られているか確認

### 日常使用時
- 慣れてきたら**短縮版**プロンプトを使用
- 定期的に設定ファイルの更新を確認
- チーム内でプロンプトパターンを統一

### チーム開発時
- プロンプトテンプレートを標準化
- 設定ファイルの変更履歴を共有
- コードレビュー時に設定遵守を確認

## 更新履歴

- 2025-07-04: 初版作成
- プロンプトパターンの定義
- 使用例とベストプラクティスの追加